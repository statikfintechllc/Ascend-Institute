<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SFTi Institue ‚Äì Sovereign Stack</title>
  <link rel="stylesheet" type="text/css" href="custom.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-dark.min.css">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta property="og:title" content="SFTi's Ascend Institute ‚Äì Sovereign Stack">
  <meta property="og:description" content="GremlinGPT, Financial Autonomy, and Self-Hosting Liberation.">
  <meta property="og:image" content="https://statikfintechllc.github.io/assets/og-image.png">
  <meta property="og:url" content="https://statikfintechllc.github.io/Ascend-Institute/">
  <style>
    main {
      max-width: 960px;
      margin: 4rem auto;
      padding: 1rem;
    }

    .admonition {
      border-left: 4px solid #444;
      padding: 1em;
      margin: 1.5em 0;
      background: #0d1117;
      border-radius: 6px;
    }

    .admonition-note { border-color: #2f81f7; }
    .admonition-tip { border-color: #3fb950; }
    .admonition-warning { border-color: #d29922; }
    .admonition-important { border-color: #8250df; }
    .admonition-caution { border-color: #f85149; }

    .admonition-title {
      font-weight: bold;
      margin-bottom: 0.5em;
    }
  </style>
</head>
<body>

  <div id="vanta-bg" style="height:100vh; position:fixed; z-index:-1; width:100%; top:0; left:0;"></div>

  <main>
    <div id="readme" class="markdown-body glass"></div>
  </main>

  <!-- IntersectionObserver polyfill for older browsers -->
  <script src="intersection-observer-polyfill.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
    // Performance optimization: Debounce VANTA animation updates
    let vantaInstance = null;
    let isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    const githubSlug = (text) =>
      text.toLowerCase()
          .trim()
          .replace(/[^\w\s-]/g, '')
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-')
          .replace(/^-|-$/g, '');

    marked.setOptions({
      headerIds: true,
      headerPrefix: '',
      mangle: false,
      slugger: {
        slug: githubSlug
      }
    });

    fetch('README.md')
      .then(res => res.ok ? res.text() : Promise.reject('README fetch failed'))
      .then(md => {
        const container = document.getElementById('readme');
        container.innerHTML = marked.parse(md);

        // Post-render transformation of admonitions (no markdown badge breakage)
        container.querySelectorAll('p').forEach(p => {
          const match = p.textContent.trim().match(/^\[!(NOTE|TIP|WARNING|IMPORTANT|CAUTION)\]/i);
          if (match) {
            const type = match[1].toLowerCase();
            const emojiMap = {
              note: 'üìù',
              tip: 'üí°',
              warning: '‚ö†Ô∏è',
              important: 'üó£Ô∏è',
              caution: '‚õîÔ∏è'
            };
            const label = match[1].charAt(0) + match[1].slice(1).toLowerCase();
            const rest = p.innerHTML.replace(/^\[!\w+\]/, '').trim();
            const div = document.createElement('div');
            div.className = `admonition admonition-${type}`;
            div.innerHTML = `<div class="admonition-title">${emojiMap[type]} ${label}</div><p>${rest}</p>`;
            p.replaceWith(div);
          }
        });

        container.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(header => {
          if (!header.id) {
            const id = githubSlug(header.textContent);
            header.id = id;
          }
        });

        container.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            const target = document.getElementById(this.getAttribute('href').slice(1));
            if (target) {
              e.preventDefault();
              target.scrollIntoView({ behavior: 'smooth' });
              history.pushState(null, null, this.getAttribute('href'));
            }
          });
        });

        // Initialize VANTA with performance optimizations
        try {
          // Skip animation if user prefers reduced motion
          if (isReducedMotion) {
            console.log('Reduced motion preferred, skipping VANTA animation');
            document.getElementById('vanta-bg').style.background = 'linear-gradient(180deg, #000 0%, #111 100%)';
          } else {
            vantaInstance = VANTA.NET({
              el: "#vanta-bg",
              mouseControls: true,
              touchControls: true,
              gyroControls: false,
              color: 0xff0000,
              backgroundColor: 0x000000,
              points: 10.00,  // Reduced from default for better performance
              maxDistance: 20.00,  // Reduced from default
              spacing: 15.00  // Increased spacing for fewer particles
            });
          }
        } catch (err) {
          console.error('VANTA initialization failed:', err);
          // Fallback to gradient background
          document.getElementById('vanta-bg').style.background = 'linear-gradient(180deg, #000 0%, #111 100%)';
        }

        // Load scrollFX.js only after content is ready
        const fxScript = document.createElement('script');
        fxScript.src = 'scrollFX.js';
        fxScript.onerror = () => console.error('Failed to load scrollFX.js');
        document.body.appendChild(fxScript);
      })
      .catch(err => {
        console.error(err);
        document.getElementById('readme').innerHTML = "<p style='color:red'>Error loading README.md</p>";
      });

    // Cleanup VANTA on page unload to prevent memory leaks
    window.addEventListener('beforeunload', () => {
      if (vantaInstance) {
        try {
          vantaInstance.destroy();
        } catch (err) {
          console.error('Error destroying VANTA:', err);
        }
      }
    });

    // Pause VANTA animation when page is hidden (performance optimization)
    document.addEventListener('visibilitychange', () => {
      if (vantaInstance && typeof vantaInstance.pause === 'function') {
        if (document.hidden) {
          vantaInstance.pause();
        } else {
          vantaInstance.play();
        }
      }
    });
  </script>
</body>
